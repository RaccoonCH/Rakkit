(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{196:function(t,a,e){"use strict";e.r(a);var s=e(0),n=Object(s.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"middlewares"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#middlewares","aria-hidden":"true"}},[t._v("#")]),t._v(" Middlewares")]),t._v(" "),e("p",[t._v("Middleware are pieces of reusable code that can be easily attached to resolvers and fields. By using middleware we can extract the commonly used code from our resolvers and then declaratively attach it using a decorator or even registering it globally.")]),t._v(" "),e("h2",{attrs:{id:"creating-middleware"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creating-middleware","aria-hidden":"true"}},[t._v("#")]),t._v(" Creating Middleware")]),t._v(" "),e("h3",{attrs:{id:"what-is-middleware"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#what-is-middleware","aria-hidden":"true"}},[t._v("#")]),t._v(" What is Middleware?")]),t._v(" "),e("p",[t._v("Middleware is a very powerful but somewhat complicated feature. Basically, middleware is a function that takes 2 arguments:")]),t._v(" "),e("ul",[e("li",[t._v("the context (Request informations / GraphQL datas)")]),t._v(" "),e("li",[t._v("the "),e("code",[t._v("next")]),t._v(" function - used to control the execution of the next middleware and the resolver to which it is attached")])]),t._v(" "),e("p",[t._v("We may be familiar with how middleware works in "),e("a",{attrs:{href:"https://expressjs.com/en/guide/writing-middleware.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("express.js")]),e("OutboundLink")],1),t._v(" but Rakkit middleware is inspired by "),e("a",{attrs:{href:"http://koajs.com/#application",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("koa.js")]),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("h3",{attrs:{id:"declaring-a-middleware"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#declaring-a-middleware","aria-hidden":"true"}},[t._v("#")]),t._v(" Declaring a middleware")]),t._v(" "),e("p",[t._v("REST and GraphQL are both Rakkit packages and use the same routing engine, so the way to declare middleware is the same as for REST."),e("br"),t._v("\nTherefore you can "),e("strong",[t._v("refer to the "),e("a",{attrs:{href:"/rest/middlewares"}},[t._v("documentation")])]),t._v(" made for REST middlewares to declare them for GraphQL.")]),t._v(" "),e("h3",{attrs:{id:"attaching-middleware"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#attaching-middleware","aria-hidden":"true"}},[t._v("#")]),t._v(" Attaching Middleware")]),t._v(" "),e("p",[t._v("To attach middleware to a resolver, place the "),e("code",[t._v("@UseMiddleware()")]),t._v(" decorator above the field or resolver declaration. And pass you middlewares as parameters:")]),t._v(" "),e("div",{staticClass:"language-typescript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-typescript"}},[e("code",[t._v("@"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Resolver")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RecipeResolver")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  @"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Query")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  @"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("UseMiddleware")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ResolveTime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LogAccess"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("randomValue")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Math"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("random")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("We can also attach the middleware to the "),e("code",[t._v("ObjectType")]),t._v(" fields.")]),t._v(" "),e("div",{staticClass:"language-typescript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-typescript"}},[e("code",[t._v("@"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ObjectType")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Recipe")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  @"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Field")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  title"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  @"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Field")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Int"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  @"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("UseMiddleware")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LogAccess"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  ratings"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h3",{attrs:{id:"global-middleware"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#global-middleware","aria-hidden":"true"}},[t._v("#")]),t._v(" Global Middleware")]),t._v(" "),e("p",[t._v("However, for common middleware like measuring resolve time or catching errors, it might be annoying to place a "),e("code",[t._v("@UseMiddleware(ResolveTime)")]),t._v(" decorator on every field/resolver.")]),t._v(" "),e("p",[t._v("Hence, in Rakkit we can also register a global middleware that will be called for each query, mutation, subscription and field resolver. For this, we use the "),e("code",[t._v("globalMiddlewares")]),t._v(" property of the "),e("code",[t._v("Rakkit.start")]),t._v(" configuration object:")]),t._v(" "),e("div",{staticClass:"language-typescript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-typescript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" Rakkit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  gql"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    resolvers"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("RecipeResolver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    globalMiddlewares"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      ErrorInterceptor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      ResolveTime\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])},[],!1,null,null,null);a.default=n.exports}}]);