<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Middlewares | Rakkit</title>
    <meta name="description" content="A framework written in TypeScript that provides REST/GraphQL API and Websocket tools to build amazing server-side applications">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">
  <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#3a0839">
  <link rel="shortcut icon" href="/favicon/favicon.ico">
  <meta name="msapplication-TileColor" content="#3a0839">
  <meta name="msapplication-config" content="/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.b5c449e4.css" as="style"><link rel="preload" href="/assets/js/app.cde378e9.js" as="script"><link rel="preload" href="/assets/js/2.d96be7e9.js" as="script"><link rel="preload" href="/assets/js/29.9045cc84.js" as="script"><link rel="prefetch" href="/assets/js/10.aecf0b49.js"><link rel="prefetch" href="/assets/js/11.df9dc6e2.js"><link rel="prefetch" href="/assets/js/12.3b278416.js"><link rel="prefetch" href="/assets/js/13.69323374.js"><link rel="prefetch" href="/assets/js/14.38a4229d.js"><link rel="prefetch" href="/assets/js/15.aa7c2e84.js"><link rel="prefetch" href="/assets/js/16.14dd4f7f.js"><link rel="prefetch" href="/assets/js/17.150d4321.js"><link rel="prefetch" href="/assets/js/18.cff99b80.js"><link rel="prefetch" href="/assets/js/19.7b694b98.js"><link rel="prefetch" href="/assets/js/20.ca08d56f.js"><link rel="prefetch" href="/assets/js/21.6a3b9e5f.js"><link rel="prefetch" href="/assets/js/22.7f88cba3.js"><link rel="prefetch" href="/assets/js/23.82ba9afb.js"><link rel="prefetch" href="/assets/js/24.1720b743.js"><link rel="prefetch" href="/assets/js/25.b010b571.js"><link rel="prefetch" href="/assets/js/26.a889ca22.js"><link rel="prefetch" href="/assets/js/27.90a281c7.js"><link rel="prefetch" href="/assets/js/28.e11f2d40.js"><link rel="prefetch" href="/assets/js/3.22cc39cc.js"><link rel="prefetch" href="/assets/js/30.9cec3ced.js"><link rel="prefetch" href="/assets/js/31.68693ff8.js"><link rel="prefetch" href="/assets/js/32.1990966a.js"><link rel="prefetch" href="/assets/js/33.2a40d71d.js"><link rel="prefetch" href="/assets/js/34.773a0e2f.js"><link rel="prefetch" href="/assets/js/35.15a7eaea.js"><link rel="prefetch" href="/assets/js/36.a096f572.js"><link rel="prefetch" href="/assets/js/37.c47c4bc8.js"><link rel="prefetch" href="/assets/js/38.fd660314.js"><link rel="prefetch" href="/assets/js/39.43aeedbe.js"><link rel="prefetch" href="/assets/js/4.bc2927b0.js"><link rel="prefetch" href="/assets/js/5.e57150a0.js"><link rel="prefetch" href="/assets/js/6.61a82962.js"><link rel="prefetch" href="/assets/js/7.7354f340.js"><link rel="prefetch" href="/assets/js/8.b9aa947b.js"><link rel="prefetch" href="/assets/js/9.e07fc09c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b5c449e4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Rakkit" class="logo"> <span class="site-name can-hide">Rakkit</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/raccoonch/rakkit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/raccoonch/rakkit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Getting started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/start/installation.html" class="sidebar-link">Installation</a></li><li><a href="/start/getting-started.html" class="sidebar-link">Getting started</a></li><li><a href="/start/rakkit.html" class="sidebar-link">The Rakkit class</a></li><li><a href="/start/demos.html" class="sidebar-link">Demos</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GraphQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>REST</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rest/router.html" class="sidebar-link">Router</a></li><li><a href="/rest/middlewares.html" class="active sidebar-link">Middlewares</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest/middlewares.html#middleware-declaration-and-use" class="sidebar-link">Middleware declaration and use</a></li><li class="sidebar-sub-header"><a href="/rest/middlewares.html#first-of-all-the-next-function" class="sidebar-link">First of all, the next function</a></li><li class="sidebar-sub-header"><a href="/rest/middlewares.html#special-case-merging-endpoint-and-middlewares" class="sidebar-link">Special case: Merging endpoint and middlewares</a></li></ul></li><li><a href="/rest/koa-middlewares.html" class="sidebar-link">Use external Koa libraries</a></li><li><a href="/rest/serving-static-files.html" class="sidebar-link">Serving static files</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Websocket</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Development</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/contributing.html" class="sidebar-link">Contribution</a></li><li><a href="/dev/changelog.html" class="sidebar-link">Changelog</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="middlewares"><a href="#middlewares" aria-hidden="true" class="header-anchor">#</a> Middlewares</h1> <p>This is <strong>a function that is executed before another</strong>, usually to modify the request in order to &quot;parse&quot; it or to block the request for example if the person does not have the required rights to access it. The middleware in Rakkit <strong>functions in the same way as those in Koa</strong>.</p> <p><strong>There are several levels of middleware:</strong></p> <ul><li>Endpoint middleware</li> <li>Middleware router</li> <li>Global middleware at the REST <code>/rest</code> router level</li> <li>Global middleware at the root router level <code>/</code></li> <li>App middleware (mostly used for koa modules)</li></ul> <p>There are also <strong>two modes of execution:</strong></p> <ul><li>Before the route</li> <li>After the route</li></ul> <p>There are <strong>two reporting modes</strong>:</p> <ul><li>Based on a class (preferred)</li> <li>Based on a class method</li></ul> <h2 id="middleware-declaration-and-use"><a href="#middleware-declaration-and-use" aria-hidden="true" class="header-anchor">#</a> Middleware declaration and use</h2> <p>You have two decorators at your disposal which are <code>@AfterMiddleware()</code> and <code>BeforeMiddleware()</code>, both of them allow you to <strong>declare middleware</strong> but the difference is in the execution order, one is to say that you want to execute one function before the route and the other after the route.<br>
We will be able to say that we want to <strong>use this middleware with the decorator</strong>* <code>@UseMiddleware(...middlewares: MiddlewareType[])</code>, we pass all the middleware used to it as parameters, be careful <strong>the order of the list is important because it defines the order of execution of the middlewares in their group (both groups being &quot;After&quot; and &quot;Before&quot;).</strong></p> <p>It is important to know how middleware is encompassed by their parents:</p> <ul><li>Endpoint middleware wrapps endpoint</li> <li>The middlewares router wrapps the endpoint middlewares</li> <li>Global middleware wrapps router middleware</li> <li>App middleware wrapps global middlewares</li></ul> <p>This gives as an order (symmetrical / onion):</p> <ul><li><strong>Before</strong> <span style="color:violet;">app</span> middleware</li> <li><strong>Before</strong> <span style="color:seagreen;">global</span> middleware</li> <li><strong>Before</strong> <span style="color:dodgerblue;">router</span> middleware</li> <li><strong>Before</strong> <span style="color:red;">endpoint</span> middleware</li> <li><em>endpoint</em></li> <li><strong>After</strong> <span style="color:red;">endpoint</span> middleware</li> <li><strong>After</strong> <span style="color:dodgerblue;">router</span> middleware</li> <li><strong>After</strong> <span style="color:seagreen;">global</span> middleware</li> <li><strong>After</strong> <span style="color:violet;">app</span> middleware</li></ul> <h2 id="first-of-all-the-next-function"><a href="#first-of-all-the-next-function" aria-hidden="true" class="header-anchor">#</a> First of all, the next function</h2> <ul><li>Works as the next function of <a href="https://koajs.com" target="_blank" rel="noopener noreferrer">Koa<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (or <a href="https://expressjs.com/fr/" target="_blank" rel="noopener noreferrer">Express<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>).</li> <li>It is <strong>passed as the second parameter (after the context) in the class methods</strong>.</li> <li>It <strong>allows you to move on to the next route</strong>, so if this function is not called it will simply send the answer back to the client without moving on to the next routes.</li> <li>If a function is asynchronous in the list of called methods it is necessary to execute <strong>next with an await</strong>, because the middleware waits for the execution of the next method which waits for the next one and so on and when everything has been executed it sends the answer to the client.</li></ul> <h3 id="declaration-at-the-endpoint-level"><a href="#declaration-at-the-endpoint-level" aria-hidden="true" class="header-anchor">#</a> Declaration at the endpoint level</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span> <span class="token comment">// Imports are not specified (Clarity)</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rakkit&quot;</span><span class="token punctuation">;</span>

@<span class="token function">BeforeMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyBeforeMiddleware</span> <span class="token keyword">implements</span> <span class="token class-name">IBaseMiddleware</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">:</span> Context<span class="token punctuation">,</span> next<span class="token punctuation">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;-2;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// To proceed to the next execution</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

@<span class="token function">BeforeMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MySecondBeforeMiddleware</span> <span class="token keyword">implements</span> <span class="token class-name">IBaseMiddleware</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">:</span> Context<span class="token punctuation">,</span> next<span class="token punctuation">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;-1;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// To proceed to the next execution</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

@<span class="token function">AfterMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyAfterMiddleware</span> <span class="token keyword">implements</span> <span class="token class-name">IBaseMiddleware</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">:</span> Context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">+=</span> <span class="token string">&quot;1;&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// next does not need to be used because there is no execution that follows</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Middleware on endpoints</span>
@<span class="token function">Router</span><span class="token punctuation">(</span><span class="token string">&quot;example&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MiddlewareOnEndpoint</span> <span class="token punctuation">{</span>
  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
  @<span class="token function">UseMiddleware</span><span class="token punctuation">(</span>
    MyBeforeMiddleware<span class="token punctuation">,</span>
    MySecondBeforeMiddleware<span class="token punctuation">,</span>
    MyAfterMiddleware
  <span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token keyword">get</span><span class="token punctuation">(</span>context<span class="token punctuation">:</span> Context<span class="token punctuation">,</span> next<span class="token punctuation">:</span> NextFunction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>body <span class="token operator">+=</span> <span class="token string">&quot;0;&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// By calling next I switch to MyAfterMiddleware middleware</span>
    <span class="token comment">// No need to call next because the following method does not include asynchronous tasks,</span>
    <span class="token comment">// but you can still put it</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In this example we have this order of execution:</p> <ul><li>MyBeforeMiddleware</li> <li>MySecondBeforeMiddleware</li> <li>get</li> <li>MyAfterMiddleware<br>
When accessing the route <code>http://localhost:4000/rest/example</code> we will therefore receive as an answer <code>-2;-1;0;1;</code></li></ul> <h3 id="declaration-at-router-level"><a href="#declaration-at-router-level" aria-hidden="true" class="header-anchor">#</a> Declaration at router level</h3> <p>By using middleware at the router, middleware will be applied to all points on the router.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// Middleware on endpoints</span>
@<span class="token function">Router</span><span class="token punctuation">(</span><span class="token string">&quot;example&quot;</span><span class="token punctuation">)</span>
@<span class="token function">UseMiddleware</span><span class="token punctuation">(</span>
  MyBeforeMiddleware<span class="token punctuation">,</span>
  MySecondBeforeMiddleware<span class="token punctuation">,</span>
  MyAfterMiddleware
<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MiddlewareOnEndpoint</span> <span class="token punctuation">{</span>
  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span>context<span class="token punctuation">:</span> Context<span class="token punctuation">,</span> next<span class="token punctuation">:</span> NextFunction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span>body <span class="token operator">+=</span> <span class="token string">&quot;0;&quot;</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// By calling next I switch to MyAfterMiddleware middleware</span>
  <span class="token punctuation">}</span>
  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;/foo&quot;</span><span class="token punctuation">)</span>
  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">:</span> Context<span class="token punctuation">,</span> next<span class="token punctuation">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span>body <span class="token operator">+=</span> <span class="token string">&quot;0;&quot;</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// By calling next I switch to MyAfterMiddleware middleware</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In this example we have this order of execution:</p> <ul><li>MyBeforeMiddleware</li> <li>MySecondBeforeMiddleware</li> <li><em>Called route</em></li> <li>MyAfterMiddleware<br>
By accessing any endpoint of this router: <code>http://localhost:4000/rest/example/*</code> (<code>/</code> or <code>/foo</code>) we will receive as an answer <code>-2;-1;0;1;</code></li></ul> <h3 id="declaration-at-the-global-level"><a href="#declaration-at-the-global-level" aria-hidden="true" class="header-anchor">#</a> Declaration at the global level</h3> <p>You can <strong>apply middlewares to all routers in your application (i.e. to all endpoints)</strong> by passing the list of these in the <code>globalRestMiddlewares</code> (<code>/rest</code> by default) or <code>globalRootMiddlewares</code> (<code>/</code> root) property of <code>Rakkit</code> as parameters.<br>
You can also use this feature to <strong>attach Koa</strong> &quot;plugins&quot;, such as <a href="https://github.com/koajs/bodyparser" target="_blank" rel="noopener noreferrer">koa-bodyparser<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which allows you to &quot;parse&quot; the body of incoming requests.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> BodyParser <span class="token keyword">from</span> <span class="token string">&quot;koa-bodyparser&quot;</span><span class="token punctuation">;</span>

Rakkit<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  rest<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    globalRootMiddlewares<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      MyBeforeMiddleware
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    globalRestMiddlewares<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      MySecondBeforeMiddleware<span class="token punctuation">,</span>
      MyAfterMiddleware
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="app-middlewares"><a href="#app-middlewares" aria-hidden="true" class="header-anchor">#</a> App middlewares</h3> <p>It defines middleware directly on the instance of the Koa application and not on Koa-Router, this allows you for example to attach Koa modules.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Cors <span class="token keyword">from</span> <span class="token string">&quot;@koa/cors&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> BodyParser <span class="token keyword">from</span> <span class="token string">&quot;koa-bodyparser&quot;</span><span class="token punctuation">;</span>

Rakkit<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  rest<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    globalAppMiddlewares<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token function">Cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">BodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="special-case-merging-endpoint-and-middlewares"><a href="#special-case-merging-endpoint-and-middlewares" aria-hidden="true" class="header-anchor">#</a> Special case: Merging endpoint and middlewares</h2> <p>As explained in the <a href="/rest/router#route-merging">router</a> part, you can merge endpoints, you can also use middlewares with this notion.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">Router</span><span class="token punctuation">(</span><span class="token string">&quot;example&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MiddlewareOnEndpoint</span> <span class="token punctuation">{</span>
  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
  @<span class="token function">UseMiddleware</span><span class="token punctuation">(</span>MyBeforeMiddleware<span class="token punctuation">)</span>
  <span class="token function">get1</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">:</span> Context<span class="token punctuation">,</span> next<span class="token punctuation">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
  @<span class="token function">UseMiddleware</span><span class="token punctuation">(</span>
    MySecondBeforeMiddleware
    MyAfterMiddleware
  <span class="token punctuation">)</span>
  <span class="token function">get2</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">:</span> Context<span class="token punctuation">,</span> next<span class="token punctuation">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>the order of execution is then:</p> <ul><li>MyBeforeMiddleware</li> <li>get1</li> <li>MySecondeBeforeMiddleware</li> <li>get2</li> <li>MyAfterMiddleware</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/raccoonch/rakkit/edit/master/docs/rest/middlewares.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/rest/router.html" class="prev">
          Router
        </a></span> <span class="next"><a href="/rest/koa-middlewares.html">
          Use external Koa libraries
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.cde378e9.js" defer></script><script src="/assets/js/2.d96be7e9.js" defer></script><script src="/assets/js/29.9045cc84.js" defer></script>
  </body>
</html>
