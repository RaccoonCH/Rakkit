<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Resolvers | Rakkit</title>
    <meta name="description" content="A framework written in TypeScript that provides REST/GraphQL API and Websocket tools to build amazing server-side applications">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">
  <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#3a0839">
  <link rel="shortcut icon" href="/favicon/favicon.ico">
  <meta name="msapplication-TileColor" content="#3a0839">
  <meta name="msapplication-config" content="/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.b5c449e4.css" as="style"><link rel="preload" href="/assets/js/app.cde378e9.js" as="script"><link rel="preload" href="/assets/js/2.d96be7e9.js" as="script"><link rel="preload" href="/assets/js/15.aa7c2e84.js" as="script"><link rel="prefetch" href="/assets/js/10.aecf0b49.js"><link rel="prefetch" href="/assets/js/11.df9dc6e2.js"><link rel="prefetch" href="/assets/js/12.3b278416.js"><link rel="prefetch" href="/assets/js/13.69323374.js"><link rel="prefetch" href="/assets/js/14.38a4229d.js"><link rel="prefetch" href="/assets/js/16.14dd4f7f.js"><link rel="prefetch" href="/assets/js/17.150d4321.js"><link rel="prefetch" href="/assets/js/18.cff99b80.js"><link rel="prefetch" href="/assets/js/19.7b694b98.js"><link rel="prefetch" href="/assets/js/20.ca08d56f.js"><link rel="prefetch" href="/assets/js/21.6a3b9e5f.js"><link rel="prefetch" href="/assets/js/22.7f88cba3.js"><link rel="prefetch" href="/assets/js/23.82ba9afb.js"><link rel="prefetch" href="/assets/js/24.1720b743.js"><link rel="prefetch" href="/assets/js/25.b010b571.js"><link rel="prefetch" href="/assets/js/26.a889ca22.js"><link rel="prefetch" href="/assets/js/27.90a281c7.js"><link rel="prefetch" href="/assets/js/28.e11f2d40.js"><link rel="prefetch" href="/assets/js/29.9045cc84.js"><link rel="prefetch" href="/assets/js/3.22cc39cc.js"><link rel="prefetch" href="/assets/js/30.9cec3ced.js"><link rel="prefetch" href="/assets/js/31.68693ff8.js"><link rel="prefetch" href="/assets/js/32.1990966a.js"><link rel="prefetch" href="/assets/js/33.2a40d71d.js"><link rel="prefetch" href="/assets/js/34.773a0e2f.js"><link rel="prefetch" href="/assets/js/35.15a7eaea.js"><link rel="prefetch" href="/assets/js/36.a096f572.js"><link rel="prefetch" href="/assets/js/37.c47c4bc8.js"><link rel="prefetch" href="/assets/js/38.fd660314.js"><link rel="prefetch" href="/assets/js/39.43aeedbe.js"><link rel="prefetch" href="/assets/js/4.bc2927b0.js"><link rel="prefetch" href="/assets/js/5.e57150a0.js"><link rel="prefetch" href="/assets/js/6.61a82962.js"><link rel="prefetch" href="/assets/js/7.7354f340.js"><link rel="prefetch" href="/assets/js/8.b9aa947b.js"><link rel="prefetch" href="/assets/js/9.e07fc09c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b5c449e4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Rakkit" class="logo"> <span class="site-name can-hide">Rakkit</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/raccoonch/rakkit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/raccoonch/rakkit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Getting started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/start/installation.html" class="sidebar-link">Installation</a></li><li><a href="/start/getting-started.html" class="sidebar-link">Getting started</a></li><li><a href="/start/rakkit.html" class="sidebar-link">The Rakkit class</a></li><li><a href="/start/demos.html" class="sidebar-link">Demos</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GraphQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>REST</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Websocket</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Development</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/contributing.html" class="sidebar-link">Contribution</a></li><li><a href="/dev/changelog.html" class="sidebar-link">Changelog</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="resolvers"><a href="#resolvers" aria-hidden="true" class="header-anchor">#</a> Resolvers</h1> <p>Besides <a href="/graphql/type/type-definition">declaring GraphQL's object types</a>, Rakkit allows us to easily create queries, mutations and field resolvers - like normal class methods, similar to REST controllers in frameworks like Java <code>Spring</code>, .NET <code>Web API</code> or with <strong><a href="/rest/router">Rakkit REST</a></strong>.</p> <h2 id="queries-and-mutations"><a href="#queries-and-mutations" aria-hidden="true" class="header-anchor">#</a> Queries and Mutations</h2> <h3 id="resolver-classes"><a href="#resolver-classes" aria-hidden="true" class="header-anchor">#</a> Resolver classes</h3> <p>First we create the resolver class and annotate it with the <code>@Resolver()</code> decorator. This class will behave like a controller from classic REST frameworks:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RecipeResolver</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>We can use a DI framework (as described in the <a href="/di/introduction">dependency injection docs</a>) to inject class dependencies (like services or repositories) or to store data inside the resolver class - it's guaranteed to be a single instance per app.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RecipeResolver</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> recipesCollection<span class="token punctuation">:</span> Recipe<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then we can create class methods which will handle queries and mutations. For example, let's add the <code>recipes</code> query to return a collection of all recipes:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RecipeResolver</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> recipesCollection<span class="token punctuation">:</span> Recipe<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token function">recipes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// fake async in this example</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>recipesCollection<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We also need to do two things.
The first is to add the <code>@Query</code> decorator, which marks the class method as a GraphQL query.
The second is to provide the return type. Since the method is async, the reflection metadata system shows the return type as a <code>Promise</code>, so we have to add the decorator's parameter as <code>returns =&gt; [Recipe]</code> to declare it resolves to an array of <code>Recipe</code> object types.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RecipeResolver</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> recipesCollection<span class="token punctuation">:</span> Recipe<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  @<span class="token function">Query</span><span class="token punctuation">(</span><span class="token parameter">returns</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>Recipe<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">recipes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>recipesCollection<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="arguments"><a href="#arguments" aria-hidden="true" class="header-anchor">#</a> Arguments</h3> <p>Usually, queries have some arguments - it might be the id of a resource, a search phrase or pagination settings. Rakkit allows you to define arguments in two ways.</p> <p>First is the inline method using the <code>@Arg()</code> decorator. The drawback is the need to repeating the argument name (due to a limitation of the reflection system) in the decorator parameter. As we can see below, we can also pass a <code>defaultValue</code> option that will be reflected in the GraphQL schema.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RecipeResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  @<span class="token function">Query</span><span class="token punctuation">(</span><span class="token parameter">returns</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>Recipe<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">recipes</span><span class="token punctuation">(</span>
    @<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> nullable<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> title<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    @<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;servings&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> defaultValue<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> servings<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Recipe<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="flat-arguments"><a href="#flat-arguments" aria-hidden="true" class="header-anchor">#</a> Flat arguments</h3> <p>TypeGraphQL behaviour is different, we have a virtual type that doesn't exists natively with GraphQL: <code>ArgsType</code>, basicaly it compiles it into an <code>InputType</code> but the difference is that the fields are flatten when you use it as query arguments.
So with Rakkit we decided to keep the existing type that is provided by GraphQL, to flat an InputType you must use the <code>@FlatArgs()</code> decorator.
e.g.:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">InputType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">GetRecipesArgs</span> <span class="token punctuation">{</span>
  @<span class="token function">Field</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> Int<span class="token punctuation">,</span> <span class="token punctuation">{</span> nullable<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  skip<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  @<span class="token function">Field</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> Int<span class="token punctuation">,</span> <span class="token punctuation">{</span> nullable<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  take<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  @<span class="token function">Field</span><span class="token punctuation">(</span><span class="token punctuation">{</span> nullable<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  title<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We can define default values for optional fields in the <code>@Field()</code> decorator using the <code>defaultValue</code> option or by using a property initializer - in both cases Rakkit will reflect this in the schema by setting the default value and making the field nullable.</p> <p>Then all that is left to do is use the args class as the type of the method parameter.
We can use the destructuring syntax to gain access to single arguments as variables, instead of the reference to the whole args object.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RecipeResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  @<span class="token function">Query</span><span class="token punctuation">(</span><span class="token parameter">returns</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>Recipe<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">recipes</span><span class="token punctuation">(</span>
    <span class="token parameter">@<span class="token function">FlatArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    recipeArgs<span class="token punctuation">:</span> GetRecipesArgs</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// sample implementation</span>
    <span class="token keyword">let</span> recipes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>recipesCollection<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>recipeArgs<span class="token punctuation">.</span>title<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      recipes <span class="token operator">=</span> recipes<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">recipe</span> <span class="token operator">=&gt;</span> recipe<span class="token punctuation">.</span>title <span class="token operator">===</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> recipes<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>startIndex<span class="token punctuation">,</span> endIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This declaration will result in the following part of the schema in SDL:</p> <div class="language-graphql extra-class"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
  <span class="token attr-name">recipes</span><span class="token punctuation">(</span><span class="token attr-name">skip</span><span class="token punctuation">:</span> Int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token attr-name">take</span><span class="token punctuation">:</span> Int <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token attr-name">title</span><span class="token punctuation">:</span> String<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Recipe<span class="token operator">!</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="input-types"><a href="#input-types" aria-hidden="true" class="header-anchor">#</a> Input types</h3> <p>GraphQL mutations can be similarly created: Declare the class method, use the <code>@Mutation</code> decorator, create arguments, provide a return type (if needed) etc. But for mutations we usually use <code>input</code> types, hence Rakkit allows us to create inputs in the same way as <a href="/graphql/type/type-definition">object types</a> but by using the <code>@InputType()</code> decorator:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">InputType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">AddRecipeInput</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>To ensure we don't accidentally change the property type we leverage the TypeScript type checking system by implementing the <code>Partial</code> type:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">InputType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">AddRecipeInput</span> <span class="token keyword">implements</span> <span class="token class-name">Partial</span><span class="token operator">&lt;</span>Recipe<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>We then declare any input fields we need, using the <code>@Field()</code> decorator:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">InputType</span><span class="token punctuation">(</span><span class="token punctuation">{</span> description<span class="token punctuation">:</span> <span class="token string">&quot;New recipe data&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">AddRecipeInput</span> <span class="token keyword">implements</span> <span class="token class-name">Partial</span><span class="token operator">&lt;</span>Recipe<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  @<span class="token function">Field</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  title<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  @<span class="token function">Field</span><span class="token punctuation">(</span><span class="token punctuation">{</span> nullable<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  description<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="querying-args-and-context"><a href="#querying-args-and-context" aria-hidden="true" class="header-anchor">#</a> Querying, args and context</h2> <h4 id="args"><a href="#args" aria-hidden="true" class="header-anchor">#</a> Args</h4> <p>After that we can use the <code>AddRecipeInput</code> type in our mutation. We can do this inline (using the <code>@Arg()</code> decorator) or as a field of the args class like in the query example above.</p> <h4 id="context"><a href="#context" aria-hidden="true" class="header-anchor">#</a> Context</h4> <p>We may also need access to the context. To achieve this there is an extra arguments (after your args) that has the <code>IContext</code> type. The GraphQL query information is available with the <code>context.gql</code> property.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> IContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rakkit&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RecipeResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  @<span class="token function">Mutation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">addRecipe</span><span class="token punctuation">(</span>
    @<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">)</span> newRecipeData<span class="token punctuation">:</span> AddRecipeInput<span class="token punctuation">,</span>
    context<span class="token punctuation">:</span> IContext
  <span class="token punctuation">)</span><span class="token punctuation">:</span> Recipe <span class="token punctuation">{</span>
    <span class="token comment">// sample implementation</span>
    <span class="token keyword">const</span> recipe <span class="token operator">=</span> RecipesUtils<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>newRecipeData<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>recipesCollection<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>recipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> recipe<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This declaration will result in the following part of the schema in SDL:</p> <div class="language-graphql extra-class"><pre class="language-graphql"><code><span class="token keyword">input</span> AddRecipeInput <span class="token punctuation">{</span>
  <span class="token attr-name">title</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
  <span class="token attr-name">description</span><span class="token punctuation">:</span> String
<span class="token punctuation">}</span>
</code></pre></div><div class="language-graphql extra-class"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Mutation</span> <span class="token punctuation">{</span>
  <span class="token attr-name">addRecipe</span><span class="token punctuation">(</span><span class="token attr-name">data</span><span class="token punctuation">:</span> AddRecipeInput<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Recipe<span class="token operator">!</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="different-ways-send-the-response"><a href="#different-ways-send-the-response" aria-hidden="true" class="header-anchor">#</a> Different ways send the response</h3> <p>You have multiple ways to return a result for you queries (to have a full compatibility between REST and GraphQL middlewares) :</p> <ul><li>using <strong><code>return</code></strong></li> <li>using <strong><code>context.gql.response</code></strong></li> <li>using <strong><code>context.body</code></strong></li> <li>using <strong><code>context.response.body</code></strong> (⚠️ response undefined, if you don't injected the koa context to your GraphQL server)</li></ul> <p>The main problem with the return type is that you must call next before the return keyword, like this:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> IContext<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rakkit&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">SpeakerResolver</span> <span class="token punctuation">{</span>
  @<span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">sayHello</span><span class="token punctuation">(</span>context<span class="token punctuation">:</span> IContext<span class="token punctuation">,</span> next<span class="token punctuation">:</span> NextFunction<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Next before the return keyword...</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>So to resolve this issue and the REST/GraphQL middleware compatibility we implemented multiple ways to achieve it by using context property assignation. You must pass the return type to the decorator and you can type the property by passing the response type to <code>IContext</code>.<br>
For example with <code>context.gql.response</code>:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> IContext<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rakkit&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">SpeakerResolver</span> <span class="token punctuation">{</span>
  @<span class="token function">Query</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> String<span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">sayHello</span><span class="token punctuation">(</span>
    <span class="token parameter">context<span class="token punctuation">:</span> IContext<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    next<span class="token punctuation">:</span> NextFunction</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span>gql<span class="token punctuation">.</span>response <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Next AFTER the return assignation</span>
<span class="token punctuation">}</span>
</code></pre></div><p>By using parameter decorators, we can get rid of unnecessary parameters (like <code>root</code>) that bloat our method definition and have to be ignored by prefixing the parameter name with <code>_</code>. Also, we can achieve a clean separation between GraphQL and our business code by using decorators, so our resolvers and their methods behave just like services which can be easily unit-tested.</p> <h2 id="field-resolvers"><a href="#field-resolvers" aria-hidden="true" class="header-anchor">#</a> Field resolvers</h2> <p>Queries and mutations are not the only type of resolvers. We often create object type field resolvers (e.g. when a <code>user</code> type has a <code>posts</code> field) which we have to resolve by fetching relational data from the database.</p> <p>Field resolvers in Rakkit are very similar to queries and mutations - we create them as a method on the resolver class but with a few modifications. First we declare which object type fields we are resolving by providing the type to the <code>@Resolver</code> decorator:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">of</span></span> <span class="token operator">=&gt;</span> Recipe<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RecipeResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// queries and mutations</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then we create a class method that will become the field resolver.
In our example we have the <code>averageRating</code> field in the <code>Recipe</code> object type that should calculate the average from the <code>ratings</code> array.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">of</span></span> <span class="token operator">=&gt;</span> Recipe<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RecipeResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// queries and mutations</span>

  <span class="token function">averageRating</span><span class="token punctuation">(</span><span class="token parameter">recipe<span class="token punctuation">:</span> Recipe</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We then mark the method as a field resolver with the <code>@FieldResolver()</code> decorator. Since we've already defined the field type in the <code>Recipe</code> class definition, there's no need to redefine it. We can get the root object of the field resolver with <code>context.gql.root</code> and you can type it by passing the type as the second parameter.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">of</span></span> <span class="token operator">=&gt;</span> Recipe<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RecipeResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// queries and mutations</span>

  @<span class="token function">FieldResolver</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> Number<span class="token punctuation">)</span>
  <span class="token function">averageRating</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">:</span> IContext<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">,</span> Recipe<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> root <span class="token operator">=</span> context<span class="token punctuation">.</span>gql<span class="token punctuation">.</span>root<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Here is the full implementation of the sample <code>averageRating</code> field resolver:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">of</span></span> <span class="token operator">=&gt;</span> Recipe<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RecipeResolver</span> <span class="token punctuation">{</span>
  <span class="token comment">// queries and mutations</span>

  @<span class="token function">FieldResolver</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> Number<span class="token punctuation">,</span> <span class="token punctuation">{</span> nullable<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">averageRating</span><span class="token punctuation">(</span>context<span class="token punctuation">:</span> IContext<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> Recipe<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Number <span class="token punctuation">{</span>
    <span class="token keyword">const</span> recipe <span class="token operator">=</span> context<span class="token punctuation">.</span>gql<span class="token punctuation">.</span>root<span class="token punctuation">;</span>
    <span class="token keyword">const</span> ratingsSum <span class="token operator">=</span> recipe<span class="token punctuation">.</span>ratings<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> recipe<span class="token punctuation">.</span>ratings<span class="token punctuation">.</span>length <span class="token operator">?</span> ratingsSum <span class="token operator">/</span> recipe<span class="token punctuation">.</span>ratings<span class="token punctuation">.</span>length <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For simple resolvers like <code>averageRating</code> or deprecated fields that behave like aliases, you can create field resolvers inline in the object type class definition:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">ObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Recipe</span> <span class="token punctuation">{</span>
  @<span class="token function">Field</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  title<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  @<span class="token function">Field</span><span class="token punctuation">(</span><span class="token punctuation">{</span> deprecationReason<span class="token punctuation">:</span> <span class="token string">&quot;Use `title` instead&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Field</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>Rate<span class="token punctuation">]</span><span class="token punctuation">)</span>
  ratings<span class="token punctuation">:</span> Rate<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  @<span class="token function">Field</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">type</span></span> <span class="token operator">=&gt;</span> Number<span class="token punctuation">,</span> <span class="token punctuation">{</span> nullable<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">averageRating</span><span class="token punctuation">(</span>@<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;since&quot;</span><span class="token punctuation">)</span> sinceDate<span class="token punctuation">:</span> Date<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ratings <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ratings<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">rate</span> <span class="token operator">=&gt;</span> rate<span class="token punctuation">.</span>date <span class="token operator">&gt;</span> sinceDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ratings<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> ratingsSum <span class="token operator">=</span> ratings<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ratingsSum <span class="token operator">/</span> ratings<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>However, if the code is more complicated and has side effects (i.e. api calls, fetching data from a databases), a resolver class method should be used instead. This way we can leverage the dependency injection mechanism, which is really helpful in testing. For example:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Repository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">of</span></span> <span class="token operator">=&gt;</span> Recipe<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RecipeResolver</span> <span class="token keyword">implements</span> <span class="token class-name">ResolverInterface</span><span class="token operator">&lt;</span>Recipe<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> userRepository<span class="token punctuation">:</span> Repository<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token comment">// dependency injection</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  @<span class="token function">FieldResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">author</span><span class="token punctuation">(</span>context<span class="token punctuation">:</span> IContext<span class="token operator">&lt;</span>User<span class="token punctuation">,</span> Recipe<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> User <span class="token punctuation">{</span>
    <span class="token keyword">const</span> recipe <span class="token operator">=</span> context<span class="token punctuation">.</span>gql<span class="token punctuation">.</span>root<span class="token punctuation">;</span>
    <span class="token keyword">const</span> author <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>recipe<span class="token punctuation">.</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>author<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SomethingWentWrongError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> author<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Note that if a field name of a field resolver doesn't exist in the resolver object type, it will create a field in the schema with this name. This feature is useful when the field is purely calculable (eg. <code>averageRating</code> from <code>ratings</code> array) and to avoid polluting the class signature.</p> <h2 id="resolver-inheritance"><a href="#resolver-inheritance" aria-hidden="true" class="header-anchor">#</a> Resolver Inheritance</h2> <p>Resolver class <code>inheritance</code> is an advanced topic covered in the <a href="/graphql/type/inheritance/#resolver-inheritance">resolver inheritance docs</a>.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/raccoonch/rakkit/edit/master/docs/graphql/query/resolvers.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/graphql/type/type-creator.html" class="prev">
          Type Creator
        </a></span> <span class="next"><a href="/graphql/query/middlewares.html">
          Middlewares
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.cde378e9.js" defer></script><script src="/assets/js/2.d96be7e9.js" defer></script><script src="/assets/js/15.aa7c2e84.js" defer></script>
  </body>
</html>
